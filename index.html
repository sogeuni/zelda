<html>
<head>
	
</head>
<body>

<button id='sign-in'>sign in</button>
token
<p id='token'></p>
<br>
info
<p id='info'></p>
<div id="map" style="width:600px;height:600px;"></div>

<script src="//www.gstatic.com/firebasejs/3.6.2/firebase.js"></script>
<script>
  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyCIKZLOCf2X25EcdVRbzjHYhuh5W5uNZvA",
    authDomain: "zelda-1492739821588.firebaseapp.com",
    databaseURL: "https://zelda-1492739821588.firebaseio.com",
    projectId: "zelda-1492739821588",
    storageBucket: "zelda-1492739821588.appspot.com",
    messagingSenderId: "142131556390"
  };
  firebase.initializeApp(config);

  function initMap() {
    var map = new google.maps.Map(document.getElementById('map'), {
      center: {lat: 0, lng: 0},
      zoom: 3,
      streetViewControl: false,
      mapTypeControlOptions: {
        mapTypeIds: ['botw']
      }
    });

    var botwMapType = new google.maps.ImageMapType({
      getTileUrl: function(coord, zoom) {
          var bound = Math.pow(2, zoom);
          // return 'http://mw1.google.com/mw-planetary/lunar/lunarmaps_v1/clem_bw' +
          //     '/' + zoom + '/' + normalizedCoord.x + '/' +
          //     (bound - normalizedCoord.y - 1) + '.jpg';
          return './map/'+zoom+'/'+zoom+'_'+coord.x+'_'+coord.y+".png";
      },
      tileSize: new google.maps.Size(256, 256),
      maxZoom: 7,
      minZoom: 0,
      // radius: 1738000,
      name: 'Botw'
    });

    map.mapTypes.set('botw', botwMapType);
    map.setMapTypeId('botw');

    map.addListener('click', function(e) {
      alert(e.latLng);
    });
  }

  function toggleSignIn() {
      if (!firebase.auth().currentUser) {
        var provider = new firebase.auth.GoogleAuthProvider();
        //provider.addScope('https://www.googleapis.com/auth/plus.login');
        provider.addScope('profile');
        
        firebase.auth().signInWithPopup(provider).then(function(result) {
          var token = result.credential.accessToken;
          var user = result.user;
          document.getElementById('token').textContent = JSON.stringify(result, null, '  ');
        }).catch(function(error) {
          var errorCode = error.code;
          var errorMessage = error.message;
          var email = error.email;
          var credential = error.credential;

          if (errorCode === 'auth/account-exists-with-different-credential') {
            alert('You have already signed up with a different auth provider for that email.');
            // If you are using multiple auth providers on your app you should handle linking
            // the user's accounts here.
          } else {
            console.error(error);
          }
        });
      } else {
        firebase.auth().signOut();
      }

      document.getElementById('sign-in').disabled = true;
    }

  function initApp() {
    firebase.auth().onAuthStateChanged(function(user) {
      if (user) {
        document.getElementById('info').textContent = JSON.stringify(user, null, '  ');
      } else {
        document.getElementById('info').textContent = '';
      }

      document.getElementById('sign-in').disabled = false;
    });

    document.getElementById('sign-in').addEventListener('click', toggleSignIn, false);
  }

  window.onload = function() {
      initApp();
  };
</script>
<script async defer src="//maps.googleapis.com/maps/api/js?key=AIzaSyCIKZLOCf2X25EcdVRbzjHYhuh5W5uNZvA&libraries=visualization&callback=initMap">
</script>
</body>
</html>